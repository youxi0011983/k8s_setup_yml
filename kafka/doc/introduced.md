# Kafka 介绍

Kafka是由Apache软件基金会开发的一个开源流处理平台，由Scala和Java编写。

Kafka是一种高吞吐量的分布式发布订阅消息系统，作为消息中间件来说都起到了系统间解耦、异步、削峰等作用，同时又提供了Kafka streaming插件包在应用端实现实时在线流处理，它可以收集并处理用户在网站中的所有动作流数据以及物联网设备的采样信息。

## 1. 特性

### 1.1 高吞吐

kafka高吞吐表现以下几点：

#### 1.1.1 Topic分区

同一个Topic的多个分区同时写入消息/多个消费者同时间消费不同分区消息
不保证全局FIFO
集群环境中的数据分布均匀

#### 1.1.2 顺序IO

顺序IO读写操作的访问地址连续，减少寻址时间
随机IO读写操作时间连续，访问地址不连续

#### 1.1.3 内存映射（memory Map File）

当CPU读取数据时，是由内存管理单元（MMU）管理的。
内核空间PageCache->磁盘（操作系统决定何时刷新）断电丢数据

#### 1.1.4 零拷贝

直接将数据从内核空间传递输出

- 零拷贝：磁盘->内核内存->socket buffer（内核态）->网络
- 常规copy：磁盘->内核内存->应用->socket buffer->网络
- 常规io：用户空间系统调用->CPU IO读取->硬盘->写入磁盘缓冲->CPU将缓冲拷贝内核缓冲->返回用户空间。全程阻塞
- DMA：用户空间系统调用->CPU IO读取->DMA IO读取->硬盘->写入磁盘缓冲->DMA将缓冲拷贝内核缓冲->通知CPU->返回用户空间。CPU不阻塞

### 1.2 Topic分区

- 可以指定一个Topic中有多少分区
- 可以指定生产/消费某个分区消息（默认轮询）

### 1.3 生产者

- 可以指定分区生产消息
- 拦截器：生产者生产消息时可做全局拦截，对消息进行统一处理
- 幂等：生产消息生成唯一标识，分区中存在唯一标识则拒绝
- 事务：事务保证幂等性，保证多个分区的数据原子性

### 1.4 消费者

- 消费者用一个消费组标记自己，同一个topic相同消费组轮询读取，不同消费组同时读取，消费者多余分区则会空闲
- 消费者定期（可配置）提交偏移量，也可手动提交偏移量
- latest（读取最新偏移量） earliest（如果系统没有消费者的偏移量，读取该分区最早的偏移量）none（异常）
- 可设置偏移量开始读取